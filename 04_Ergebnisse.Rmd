---
output:
  pdf_document: default
  html_document: default
---

## Alpha

Hier werden die Ergebnisse für Alpha dargestellt.


<!--Alpha-Regression Alter in Jahren-->
```{r Alpha-Regression Alter in Jahren, echo=FALSE, warning= FALSE}

#model_alpha_age_y_summary <- summary_final_age %>%lm(alpha~age_y, data = .) %>%tidy()knitr::kable(model_alpha_age_y_summary)

attach(summary_final_age)
model1 <- lm(alpha~age_y)
```


<!--Alpha-Regression Alter in Klassen-->
```{r Alpha-Regression Alter in Klassen, echo=FALSE, warning= FALSE}

# 1. Erstellen von Dummy-Variablen für die Altersklassen

summary_final_age <- summary_final_age %>%
  mutate(young = case_when(`age_y` <= 1 ~ 1,
                           `age_y` > 1 ~ 0),
         medium = case_when(`age_y` >= 2 & `age_y` <= 4 ~ 1,
                            `age_y` < 2 | `age_y` > 4 ~ 0),
         old = case_when(`age_y` > 4 ~ 1,
                         `age_y` <= 4 ~ 0))


# 2. Durchführen der Regression

#model_alpha_age_c_summary <- summary_final_age %>%lm(alpha~young + old, data = .) %>%               # Klasse 'medium' als Referenz-Kategorietidy()knitr::kable(model_alpha_age_c_summary)


attach(summary_final_age)
model2 <- lm(alpha~young + old)

```

<!--Alpha-Regression Größe in Klassen nach Jones-->
```{r Alpha-Regression Größe in Klassen nach Jones, echo=FALSE, warning= FALSE}

# 1. Erstellen von Dummy-Variablen für die Altersklassen

summary_final_size <- summary_final_size %>%
  mutate(small = case_when(`size` <= 100000000 ~ 1,
                           `size` > 100000000 ~ 0),
         medium = case_when(`size` > 100000000 & `size` <= 500000000 ~ 1,
                            `size` <= 100000000 | `size` > 500000000 ~ 0),
         big = case_when(`size` > 500000000 ~ 1,
                         `size` <= 500000000 ~ 0))


# 2. Durchführen der Regression

#model_alpha_size_c_summary <- summary_final_size %>%lm(alpha~small + big, data = .) %>%               # Klasse 'medium' als Referenz-Kategorietidy()knitr::kable(model_alpha_size_c_summary)


attach(summary_final_size)
model3 <- lm(alpha~small + big)



```

<!--Alpha-Regression Größe in Klassen nach Quantilen-->
```{r Alpha-Regression Größe in Klassen nach Quantilen, echo=FALSE, warning= FALSE}

# 1. Erstellen von Dummy-Variablen für die Size-Klassen


summary_final_size <- summary_final_size %>%
  mutate(Q_1 = case_when(`Quantile_Class` == "1" ~ 1,
                         `Quantile_Class` != "1" ~ 0),
         Q_2 = case_when(`Quantile_Class` == "2" ~ 1,
                         `Quantile_Class` != "2" ~ 0),
         Q_3 = case_when(`Quantile_Class` == "3" ~ 1,
                         `Quantile_Class` != "3" ~ 0),
         Q_4 = case_when(`Quantile_Class` == "4" ~ 1,
                         `Quantile_Class` != "4" ~ 0),
         Q_5 = case_when(`Quantile_Class` == "5" ~ 1,
                         `Quantile_Class` != "5" ~ 0))


# 2. Durchführen der Regression

#model_alpha_size_cq_summary <- summary_final_size %>%lm(alpha~Q_2 + Q_3 + Q_4 + Q_5, data = .) %>%               # Klasse 'Q_1' als Referenz-Kategorietidy()knitr::kable(model_alpha_size_cq_summary)

attach(summary_final_size)
model4 <- lm(alpha~Q_2 + Q_3 + Q_4 + Q_5)

```


```{r,echo=FALSE, results='asis'}
library(stargazer)
#luca: würde das noch in literatur aufnehmen
#Hlavac, Marek (2022). stargazer: Well-Formatted Regression and Summary Statistics Tables. R package version 5.2.3. https://CRAN.R-project.org/package=stargazer


stargazer(model1,model2, header=FALSE, type='latex', model.numbers= FALSE, title = "Four Regression Models Predicting Influence on Alpha Part 1",  column.labels = c("Age", "Age Classes"),omit.stat = c("rsq", "f")
)
```
Zweiter Teil für Size sieht so aus

\newpage


```{r,echo=FALSE, results='asis'} 

stargazer(model3,model4, header=FALSE, type='latex', model.numbers= FALSE, title = "Four Regression Models Predicting Influence on Alpha Part 2",  column.labels = c("Size Classes", "Size Quantiles"),omit.stat = c("rsq", "f")
)
```


## Carhart's alpha (optional)

Hier werden die Ergebnisse für Carhart's alpha dargestellt.


## Sharpe Ratios

Hier werden die Sharpe Ratios der Fonds berechnet und dargestellt.

<!--SR-Regression Alter in Jahren-->
```{r SR-Regression Alter in Jahren, echo=FALSE, warning= FALSE}

#model_sr_age_y_summary <- summary_final_age %>%lm(sr~age_y, data = .) %>%tidy()

attach(summary_final_age)
model1_SR <- lm(sr~age_y)

```

<!--SR-Regression Alter in Klassen-->
```{r SR-Regression Alter in Klassen, echo=FALSE, warning= FALSE}

#model_sr_age_c_summary <- summary_final_age %>%lm(sr~young + old, data = .) %>%               # Klasse 'medium' als Referenz-Kategorietidy()

attach(summary_final_age)
model2_SR <- lm(sr~young + old)

```

<!--SR-Regression Größe in Klassen nach Jones-->
```{r SR-Regression Größe in Klassen nach Jones, echo=FALSE, warning= FALSE}

#model_sr_size_c_summary <- summary_final_size %>%lm(sr~small + big, data = .) %>%               # Klasse 'medium' als Referenz-Kategorietidy()

attach(summary_final_size)
model3_SR <- lm(sr~small + big)
```

<!--SR-Regression Größe in Klassen nach Quantilen-->
```{r SR-Regression Größe in Klassen nach Quantilen, echo=FALSE, warning= FALSE}

#model_sr_size_cq_summary <- summary_final_size %>%lm(sr~ Q_2 + Q_3 + Q_4 + Q_5, data = .) %>%               # Klasse 'Q_1' als Referenz-Kategorietidy()

attach(summary_final_size)
model4_SR <- lm(sr~Q_2 + Q_3 + Q_4 + Q_5)

```


```{r,echo=FALSE, results='asis'} 

stargazer(model1_SR,model2_SR, header=FALSE, type='latex', model.numbers= FALSE, title = "Four Regression Models Predicting Influence on Sharpe Ratio Part 1",  column.labels = c("Size Classes", "Size Quantiles"),omit.stat = c("rsq", "f")
)
```
Erläuterung der Ergebnisse

\newpage
```{r,echo=FALSE, results='asis'} 

stargazer(model3_SR,model4_SR, header=FALSE, type='latex', model.numbers= FALSE, title = "Four Regression Models Predicting Influence on Sharp Ratio Part 2",  column.labels = c("Size Classes", "Size Quantiles"),omit.stat = c("rsq", "f")
)
```




## Information Ratio

Hier werden die Information Ratios berechnet und dargestellt.


<!--IR-Regression Alter in Jahren-->
```{r IR-Regression Alter in Jahren, echo=FALSE, warning= FALSE}

#model_ir_age_y_summary <- summary_final_age %>%lm(ir~age_y, data = .) %>%tidy()

attach(summary_final_age)
model1_IR <- lm(ir~age_y)

```

<!--IR-Regression Alter in Klassen-->
```{r IR-Regression Alter in Klassen, echo=FALSE, warning= FALSE}

#model_ir_age_c_summary <- summary_final_age %>%lm(ir~young + old, data = .) %>%               # Klasse 'medium' als Referenz-Kategorietidy()

attach(summary_final_age)
model2_IR <- lm(ir~young + old)

```

<!--IR-Regression Größe in Klassen nach Jones-->
```{r IR-Regression Größe in Klassen nach Jones, echo=FALSE, warning= FALSE}

#model_ir_size_c_summary <- summary_final_size %>%lm(ir~small + big, data = .) %>%               # Klasse 'medium' als Referenz-Kategorietidy()

attach(summary_final_size)
model3_IR <- lm(ir~small + big)

```

<!--IR-Regression Größe in Klassen nach Quantilen-->
```{r IR-Regression Größe in Klassen nach Quantilen, echo=FALSE, warning= FALSE}

#model_ir_size_cq_summary <- summary_final_size %>%lm(ir~ Q_2 + Q_3 + Q_4 + Q_5, data = .) %>%               # Klasse 'Q_1' als Referenz-Kategorietidy()

attach(summary_final_size)
model4_IR <- lm(ir~Q_2 + Q_3 + Q_4 + Q_5)

```




```{r,echo=FALSE, results='asis'} 

stargazer(model1_IR,model2_IR, header=FALSE, type='latex', model.numbers= FALSE, title = "Four Regression Models Predicting Influence on Information Ratio Part 1",  column.labels = c("Size Classes", "Size Quantiles"),omit.stat = c("rsq", "f")
)
```
Erläuterung der Ergebnisse

\newpage
```{r,echo=FALSE, results='asis'} 

stargazer(model3_IR,model4_IR, header=FALSE, type='latex', model.numbers= FALSE, title = "Four Regression Models Predicting Influence on Information Ratio Part 2",  column.labels = c("Size Classes", "Size Quantiles"),omit.stat = c("rsq", "f")
)
```




## Sortino Ratio (optional)

Hier werden die Sortino Ratios berechnet und dargestellt.


## Coherence

Hier wird erläutert, inwieweit identifizierte "Top-Fonds" Beständigkeit über mehrere Performance-Maße hinweg aufweisen.

<!--Vergleichendes Ranking nach Risk adjusted Returns Age-->
```{r Ranking-Table Age, echo=FALSE, warning=FALSE}

Ranking_age <- summary_final_age %>%
  mutate(sr_rank = dense_rank(desc(sr)),
         ir_rank = dense_rank(desc(ir)),
         alpha_rank = dense_rank(desc(alpha))) %>%
  mutate(coherence = case_when(`alpha_rank` < 4 | `sr_rank` < 4 | `ir_rank` < 4 ~ "top",
                               TRUE ~ "NA")) %>%
  filter(coherence == "top") %>%
  arrange(sr_rank) %>%
  select(name,age_class, sr_rank, ir_rank, alpha_rank) %>%
  rename(Name = name,Class=age_class, `SR Rank` = sr_rank, `IR Rank` = ir_rank, `Alpha Rank` = alpha_rank)


kable(Ranking_age, booktabs = TRUE,
        caption = "Top 3 Hedge Fonds nach Alpha, SR und IR (Alter, 2005-2015)")

```

```{r}

#kumuierte returns für jeden fund in subset

tidy_return_age_sub <- tidy_return_age
tidy_return_age_sub[is.na(tidy_return_age_sub)] <- 0


tidy_return_age_sub <- tidy_return_age_sub%>%
  group_by(secid)%>%
  mutate(cum_ret=cumsum(ret))


#erstellen eines sub-sets
factor_data_age_sub <- factor_data_age %>%
    pivot_longer(cols = mktrf,
                  names_to = "secid",
                  values_to = "ret")%>%
  mutate(cum_ret=cumsum(ret))%>%
  select(date,secid,cum_ret)

#alle secids:"FOUSA08N44","FHUSA04BLA","FOUSA08ZJV","FHUSA04AHN","FOUSA0883N","FHUSA04ADN","FHUSA04BAI"

#liste der funds mit vorauswahl                    
list_age_sub <- c("mktrf","FOUSA08N44","FHUSA04BLA","FOUSA0883N","FHUSA04ADN","FHUSA04BAI")   

#merge, auswahl für die funds und market
final_data_age_sub <- bind_rows(tidy_return_age_sub, factor_data_age_sub)%>%
  select(date,secid,cum_ret)%>%
  filter(secid %in% list_age_sub)%>%
  rename(Name=secid)

#%>%filter(date>= "2005-02-28") wenn man nicht mit cum return=0, sondern Wert anfangen möchte

#umbenennung der secid in die Namen der Funds
final_data_age_sub[,2][final_data_age_sub[,2] == "mktrf"] <- "Market Rate"
final_data_age_sub[,2][final_data_age_sub[,2] == "FOUSA08N44"] <- "Artorius Partners II"
final_data_age_sub[,2][final_data_age_sub[,2] == "FHUSA04BLA"] <- "AJW Partners II LLC Class B"
final_data_age_sub[,2][final_data_age_sub[,2] == "FOUSA0883N"] <- "CCM S&P 500 Long Short"
final_data_age_sub[,2][final_data_age_sub[,2] == "FHUSA04ADN"] <- "Strand US Fund"
final_data_age_sub[,2][final_data_age_sub[,2] == "FHUSA04BAI"] <- "LIM China Index Limited B"

#aussortierte funds
#final_data_age_sub[,2][final_data_age_sub[,2] == "FOUSA08ZJV"] <- "Gladwyne Capital, L.P."
#final_data_age_sub[,2][final_data_age_sub[,2] == "FHUSA04AHN"] <- "Loch Capital I LP"

```


```{r}
#plot der returns, reihenfolge nach alpha für Age

final_data_age_sub$Name <- factor(final_data_age_sub$Name, levels = c("LIM China Index Limited B", "Strand US Fund","CCM S&P 500 Long Short","AJW Partners II LLC Class B","Artorius Partners II", "Market Rate"))



ggplot(data=final_data_age_sub) + aes(x=date, y = cum_ret, color = Name) + geom_line(size=0.8)+scale_color_viridis(discrete = TRUE)+ theme_minimal()

```



<!--Vergleichendes Ranking nach Risk adjusted Returns Size-->
```{r Ranking-Table Size, echo=FALSE, warning=FALSE}

Ranking_size <- summary_final_size %>%
  mutate(sr_rank = dense_rank(desc(sr)),
         ir_rank = dense_rank(desc(ir)),
         alpha_rank = dense_rank(desc(alpha))) %>%
  mutate(coherence = case_when(`alpha_rank` < 4 | `sr_rank` < 4 | `ir_rank` < 4 ~ "top",
                               TRUE ~ "NA")) %>%
  filter(coherence == "top") %>%
  arrange(sr_rank) %>%
  select(name,Quantile_Class, sr_rank, ir_rank, alpha_rank) %>%
  rename(Name = name, `SR Rank` = sr_rank, `IR Rank` = ir_rank, `Alpha Rank` = alpha_rank)

kable(Ranking_size, booktabs = TRUE,
        caption = "Top 3 Hedge Fonds nach Alpha, SR und IR (Größe, 2010-2020)") 

```

```{r}

#kumuierte returns für jeden fund in subset

tidy_return_size_sub <- tidy_return_size
tidy_return_size_sub[is.na(tidy_return_size_sub)] <- 0


tidy_return_size_sub <- tidy_return_size_sub%>%
  group_by(secid)%>%
  mutate(cum_ret=cumsum(ret))


#erstellen eines sub-sets
factor_data_size_sub <- factor_data_size %>%
    pivot_longer(cols = mktrf,
                  names_to = "secid",
                  values_to = "ret")%>%
  mutate(cum_ret=cumsum(ret))%>%
  select(date,secid,cum_ret)

#alle secids: "FHUSA04FL4","FOUSA08N44", "FOUSA088YN","FOUSA06V3X", "FOUSA06UI4", "FOUSA06A67"


#liste der funds                   
list_size_sub <- c("mktrf","FHUSA04FL4","FOUSA08N44", "FOUSA088YN","FOUSA06V3X", "FOUSA06UI4", "FOUSA06A67")   

#merge, auswahl für die funds und market
final_data_size_sub <- bind_rows(tidy_return_size_sub, factor_data_size_sub)%>%
  select(date,secid,cum_ret)%>%
  filter(secid %in% list_size_sub)%>%
  rename(Name=secid)

#%>%filter(date>= "2010-02-28") wenn man nicht mit cum return=0, sondern Wert anfangen möchte

#umbenennung der secid in die Namen der Funds
final_data_size_sub[,2][final_data_size_sub[,2] == "mktrf"] <- "Market Rate"
final_data_size_sub[,2][final_data_size_sub[,2] == "FOUSA08N44"] <- "Artorius Partners II"
final_data_size_sub[,2][final_data_size_sub[,2] == "FHUSA04FL4"] <- "Echo Street Capital Partners LP"
final_data_size_sub[,2][final_data_size_sub[,2] == "FOUSA088YN"] <- "Aristides Fund LP"
final_data_size_sub[,2][final_data_size_sub[,2] == "FOUSA06V3X"] <- "Dendrich Fund"
final_data_size_sub[,2][final_data_size_sub[,2] == "FOUSA06UI4"] <- "SYW LP"
final_data_size_sub[,2][final_data_size_sub[,2] == "FOUSA06A67"] <- "PharmaInvest Fund"

```

```{r}
#plot der returns, reihenfolge nach alpha für Size

final_data_size_sub$Name <- factor(final_data_size_sub$Name, levels = c("Dendrich Fund","SYW LP","PharmaInvest Fund","Echo Street Capital Partners LP","Aristides Fund LP","Artorius Partners II", "Market Rate"))



ggplot(data=final_data_size_sub) + aes(x=date, y = cum_ret, color = Name) + geom_line(size=0.8)+scale_color_viridis(discrete = TRUE)+ theme_minimal()
```




## Persistence

'Performance Persistence' beschreibt, wie stetig die Performance eines Hedge Funds ist - also wie konstant ein Hedge Fund performt.[@Stafylas.2016, p. 15]


\newpage